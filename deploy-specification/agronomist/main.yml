Parameters:
  Environment:
    Type: String
  TemplateUrlPrefix:
    Type: String
  LambdaPrefix:
    Type: String
  LayerPrefix:
    Type: String
  ArtifactsBucket:
    Type: String
  CompanyName:
    Type: String
  ServiceName:
    Type: String
Resources:
  resourcesCognitoUserPoolIdParameterD8918C4B:
    Type: AWS::SSM::Parameter
    Properties:
      Type: String
      Value:
        Ref: CognitoUserPoolusersUserPool89376787
      Name: /infra/ENV/auth/cognito/user-pool/id/SERVICE_NAME
  resourcesCognitoUserPoolClientAppIdParameter5CD0B116:
    Type: AWS::SSM::Parameter
    Properties:
      Type: String
      Value:
        Ref: CognitoUserPoolusersUserPoolusersUserPoolClientApp6F150F91
      Name: /infra/ENV/auth/cognito/user-pool/client/id/SERVICE_NAME
  resourcesCognitoIdentityPoolIdParameterCDFE2EC9:
    Type: AWS::SSM::Parameter
    Properties:
      Type: String
      Value:
        Ref: IdentityPool
      Name: /infra/ENV/auth/cognito/identity-pool/id/SERVICE_NAME
  CognitoUserPoolusersUserPool89376787:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
          - Name: verified_email
            Priority: 1
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: true
      AliasAttributes:
        - email
      AutoVerifiedAttributes:
        - email
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      MfaConfiguration: "OFF"
      Policies:
        PasswordPolicy:
          MinimumLength: 6
          RequireLowercase: true
          RequireNumbers: true
          TemporaryPasswordValidityDays: 7
      Schema:
        - Mutable: true
          Name: name
          Required: true
        - Mutable: true
          Name: email
          Required: true
        - Mutable: true
          Name: email_verified
          Required: false
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -users
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
  CognitoUserPoolusersUserPoolusersUserPoolClientApp6F150F91:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      UserPoolId:
        Ref: CognitoUserPoolusersUserPool89376787
      AllowedOAuthFlows:
        - implicit
        - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
        - profile
        - phone
        - email
        - openid
        - aws.cognito.signin.user.admin
      CallbackURLs:
        - https://example.com
      ExplicitAuthFlows:
        - ALLOW_USER_PASSWORD_AUTH
        - ALLOW_REFRESH_TOKEN_AUTH
      PreventUserExistenceErrors: ENABLED
      SupportedIdentityProviders:
        - COGNITO
      WriteAttributes:
        - email
        - name
  IdentityPool:
    Type: AWS::Cognito::IdentityPool
    Properties:
      AllowUnauthenticatedIdentities: true
      AllowClassicFlow: true
      CognitoIdentityProviders:
        - ClientId:
            Ref: CognitoUserPoolusersUserPoolusersUserPoolClientApp6F150F91
          ProviderName:
            Fn::GetAtt:
              - CognitoUserPoolusersUserPool89376787
              - ProviderName
          ServerSideTokenCheck: false
      IdentityPoolName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -identities
  AuthenticatedRole86104F1A:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRoleWithWebIdentity
            Condition:
              StringEquals:
                cognito-identity.amazonaws.com:aud:
                  Ref: IdentityPool
              ForAnyValue:StringLike:
                cognito-identity.amazonaws.com:amr: authenticated
            Effect: Allow
            Principal:
              Federated: cognito-identity.amazonaws.com
        Version: "2012-10-17"
      RoleName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -authenticatedRole
  AuthenticatedRoleDefaultPolicy8B1AC271:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: cognito-identity:*
            Effect: Allow
            Resource: "*"
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - APPBUCKETNAMECONTROLLERCAMERAFRAMESBucket6E2D1111
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - APPBUCKETNAMECONTROLLERCAMERAFRAMESBucket6E2D1111
                        - Arn
                    - /*
        Version: "2012-10-17"
      PolicyName: AuthenticatedRoleDefaultPolicy8B1AC271
      Roles:
        - Ref: AuthenticatedRole86104F1A
  UnauthenticatedRole01CC4258:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRoleWithWebIdentity
            Condition:
              StringEquals:
                cognito-identity.amazonaws.com:aud:
                  Ref: IdentityPool
              ForAnyValue:StringLike:
                cognito-identity.amazonaws.com:amr: unauthenticated
            Effect: Allow
            Principal:
              Federated: cognito-identity.amazonaws.com
        Version: "2012-10-17"
      RoleName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -unauthenticatedRole
  RoleAttachment:
    Type: AWS::Cognito::IdentityPoolRoleAttachment
    Properties:
      IdentityPoolId:
        Ref: IdentityPool
      Roles:
        authenticated:
          Fn::GetAtt:
            - AuthenticatedRole86104F1A
            - Arn
        unauthenticated:
          Fn::GetAtt:
            - UnauthenticatedRole01CC4258
            - Arn
  serviceRestApiUrlParameterE84B23D3:
    Type: AWS::SSM::Parameter
    Properties:
      Type: String
      Value:
        Fn::Join:
          - ""
          - - https://
            - Ref: RestApi0C43BF4B
            - .execute-api.
            - Ref: AWS::Region
            - "."
            - Ref: AWS::URLSuffix
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /
      Name: /infra/ENV/backend/rest/url/SERVICE_NAME
  serviceCognitoAuthorizer016061C3:
    Type: AWS::ApiGateway::Authorizer
    Properties:
      RestApiId:
        Ref: RestApi0C43BF4B
      Type: COGNITO_USER_POOLS
      IdentitySource: method.request.header.Authorization
      Name: agronomistserviceCognitoAuthorizer1D5CB396
      ProviderARNs:
        - Fn::GetAtt:
            - CognitoUserPoolusersUserPool89376787
            - Arn
  SERVICENAMEcloudcommonLayer27E77984:
    Type: AWS::Lambda::LayerVersion
    Properties:
      Content:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LayerPrefix
              - /cloud-common.zip
      LayerName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -cloud-common
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
  SERVICENAMEcontrollerframefetcherFuncServiceRole9B3365E2:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEcontrollerframefetcherFunc55749CA1:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /controller_frame_fetcher.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEcontrollerframefetcherFuncServiceRole9B3365E2
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -controller_frame_fetcher
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEcontrollerframefetcherFuncServiceRole9B3365E2
  SERVICENAMEcontrollerframefetcherFuncInvokeServicePrincipalapigatewayamazonawscom0BA4684B:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerframefetcherFunc55749CA1
          - Arn
      Principal: apigateway.amazonaws.com
  controllerframefetcherErrorAlarmF4E43032:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for controller_frame_fetcher lambda errors
      AlarmName: controller_frame_fetcherErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEcontrollerframefetcherFunc55749CA1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  controllerframefetcherThrottleAlarm27BB7482:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for controller_frame_fetcher lambda throttling
      AlarmName: controller_frame_fetcherThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEcontrollerframefetcherFunc55749CA1
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  SERVICENAMEcontrollerframeindexerFuncServiceRole013325E7:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEcontrollerframeindexerFuncServiceRoleDefaultPolicy0FFA7CAF:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - sqs:ReceiveMessage
              - sqs:ChangeMessageVisibility
              - sqs:GetQueueUrl
              - sqs:DeleteMessage
              - sqs:GetQueueAttributes
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - controllerframeindexers3eventS3Queuecontrollerframeindexers3eventQueue10F20BF3
                - Arn
        Version: "2012-10-17"
      PolicyName: SERVICENAMEcontrollerframeindexerFuncServiceRoleDefaultPolicy0FFA7CAF
      Roles:
        - Ref: SERVICENAMEcontrollerframeindexerFuncServiceRole013325E7
  SERVICENAMEcontrollerframeindexerFunc112D9367:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /controller_frame_indexer.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEcontrollerframeindexerFuncServiceRole013325E7
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -controller_frame_indexer
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEcontrollerframeindexerFuncServiceRoleDefaultPolicy0FFA7CAF
      - SERVICENAMEcontrollerframeindexerFuncServiceRole013325E7
  SERVICENAMEcontrollerframeindexerFuncInvokeServicePrincipalsqsamazonawscomF4C4CF9F:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerframeindexerFunc112D9367
          - Arn
      Principal: sqs.amazonaws.com
  SERVICENAMEcontrollerframeindexerFunccontrollerframeindexers3eventSqsEventSourceA751F8C0:
    Type: AWS::Lambda::EventSourceMapping
    Properties:
      FunctionName:
        Ref: SERVICENAMEcontrollerframeindexerFunc112D9367
      BatchSize: 10
      EventSourceArn:
        Fn::GetAtt:
          - controllerframeindexers3eventS3Queuecontrollerframeindexers3eventQueue10F20BF3
          - Arn
      MaximumBatchingWindowInSeconds: 300
  controllerframeindexers3eventS3Queuecontrollerframeindexers3eventdlqDLQueueB561819F:
    Type: AWS::SQS::Queue
    Properties:
      MessageRetentionPeriod: 345600
      QueueName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -controller_frame_indexer-s3-event-dlq
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
  controllerframeindexers3eventS3Queuecontrollerframeindexers3eventdlqAlarmE642389F:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for controller_frame_indexer-s3-event-dlq DLQ Message count
      AlarmName: controller_frame_indexer-s3-event-dlqAlarm
      Metrics:
        - Id: m1
          Label: Number of Messages in DLQ
          MetricStat:
            Metric:
              Dimensions:
                - Name: QueueName
                  Value:
                    Fn::GetAtt:
                      - controllerframeindexers3eventS3Queuecontrollerframeindexers3eventdlqDLQueueB561819F
                      - QueueName
              MetricName: NumberOfMessagesSent
              Namespace: AWS/SQS
            Period: 300
            Stat: Sum
          ReturnData: true
      Threshold: 1
  controllerframeindexers3eventS3Queuecontrollerframeindexers3eventQueue10F20BF3:
    Type: AWS::SQS::Queue
    Properties:
      QueueName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -controller_frame_indexer-s3-event
      ReceiveMessageWaitTimeSeconds: 20
      RedrivePolicy:
        deadLetterTargetArn:
          Fn::GetAtt:
            - controllerframeindexers3eventS3Queuecontrollerframeindexers3eventdlqDLQueueB561819F
            - Arn
        maxReceiveCount: 20
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
  controllerframeindexers3eventS3Queuecontrollerframeindexers3eventQueuePolicyFD0B1102:
    Type: AWS::SQS::QueuePolicy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - sqs:SendMessage
              - sqs:GetQueueAttributes
              - sqs:GetQueueUrl
            Condition:
              ArnLike:
                aws:SourceArn:
                  Fn::GetAtt:
                    - APPBUCKETNAMECONTROLLERCAMERAFRAMESBucket6E2D1111
                    - Arn
            Effect: Allow
            Principal:
              Service: s3.amazonaws.com
            Resource:
              Fn::GetAtt:
                - controllerframeindexers3eventS3Queuecontrollerframeindexers3eventQueue10F20BF3
                - Arn
        Version: "2012-10-17"
      Queues:
        - Ref: controllerframeindexers3eventS3Queuecontrollerframeindexers3eventQueue10F20BF3
  APPBUCKETNAMECONTROLLERCAMERAFRAMESBucket6E2D1111:
    Type: AWS::S3::Bucket
    Properties:
      BucketName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: CompanyName
            - -controller-camera-frames
      CorsConfiguration:
        CorsRules:
          - AllowedHeaders:
              - "*"
            AllowedMethods:
              - GET
              - HEAD
            AllowedOrigins:
              - "*"
      PublicAccessBlockConfiguration:
        BlockPublicAcls: false
        BlockPublicPolicy: false
        IgnorePublicAcls: false
        RestrictPublicBuckets: false
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
  APPBUCKETNAMECONTROLLERCAMERAFRAMESBucketNotificationsD8AAE271:
    Type: Custom::S3BucketNotifications
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691
          - Arn
      BucketName:
        Ref: APPBUCKETNAMECONTROLLERCAMERAFRAMESBucket6E2D1111
      NotificationConfiguration:
        QueueConfigurations:
          - Events:
              - s3:ObjectCreated:*
            QueueArn:
              Fn::GetAtt:
                - controllerframeindexers3eventS3Queuecontrollerframeindexers3eventQueue10F20BF3
                - Arn
          - Events:
              - s3:ObjectRemoved:Delete
            QueueArn:
              Fn::GetAtt:
                - controllerframeindexers3eventS3Queuecontrollerframeindexers3eventQueue10F20BF3
                - Arn
    DependsOn:
      - controllerframeindexers3eventS3Queuecontrollerframeindexers3eventQueuePolicyFD0B1102
      - controllerframeindexers3eventS3Queuecontrollerframeindexers3eventQueue10F20BF3
  APPBUCKETNAMECONTROLLERCAMERAFRAMESBucketNameParameterE611190F:
    Type: AWS::SSM::Parameter
    Properties:
      Type: String
      Value:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: CompanyName
            - -controller-camera-frames
      Name: /infra/ENV/buckets/controller-camera-frames
  BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
  BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: s3:PutBucketNotification
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36
      Roles:
        - Ref: BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC
  BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691:
    Type: AWS::Lambda::Function
    Properties:
      Description: AWS CloudFormation handler for "Custom::S3BucketNotifications" resources (@aws-cdk/aws-s3)
      Code:
        ZipFile: >-
          exports.handler = (event, context) => {
              // eslint-disable-next-line @typescript-eslint/no-require-imports, import/no-extraneous-dependencies
              const s3 = new (require('aws-sdk').S3)();
              // eslint-disable-next-line @typescript-eslint/no-require-imports
              const https = require('https');
              // eslint-disable-next-line @typescript-eslint/no-require-imports
              const url = require('url');
              log(JSON.stringify(event, undefined, 2));
              const props = event.ResourceProperties;
              if (event.RequestType === 'Delete') {
                  props.NotificationConfiguration = {}; // this is how you clean out notifications
              }
              const req = {
                  Bucket: props.BucketName,
                  NotificationConfiguration: props.NotificationConfiguration,
              };
              return s3.putBucketNotificationConfiguration(req, (err, data) => {
                  log({ err, data });
                  if (err) {
                      return submitResponse('FAILED', err.message + `\nMore information in CloudWatch Log Stream: ${context.logStreamName}`);
                  }
                  else {
                      return submitResponse('SUCCESS');
                  }
              });
              function log(obj) {
                  console.error(event.RequestId, event.StackId, event.LogicalResourceId, obj);
              }
              // eslint-disable-next-line max-len
              // adapted from https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-lambda-function-code.html#cfn-lambda-function-code-cfnresponsemodule
              // to allow sending an error message as a reason.
              function submitResponse(responseStatus, reason) {
                  const responseBody = JSON.stringify({
                      Status: responseStatus,
                      Reason: reason || 'See the details in CloudWatch Log Stream: ' + context.logStreamName,
                      PhysicalResourceId: event.PhysicalResourceId || event.LogicalResourceId,
                      StackId: event.StackId,
                      RequestId: event.RequestId,
                      LogicalResourceId: event.LogicalResourceId,
                      NoEcho: false,
                  });
                  log({ responseBody });
                  const parsedUrl = url.parse(event.ResponseURL);
                  const options = {
                      hostname: parsedUrl.hostname,
                      port: 443,
                      path: parsedUrl.path,
                      method: 'PUT',
                      headers: {
                          'content-type': '',
                          'content-length': responseBody.length,
                      },
                  };
                  const request = https.request(options, (r) => {
                      log({ statusCode: r.statusCode, statusMessage: r.statusMessage });
                      context.done();
                  });
                  request.on('error', (error) => {
                      log({ sendError: error });
                      context.done();
                  });
                  request.write(responseBody);
                  request.end();
              }
          };
      Handler: index.handler
      Role:
        Fn::GetAtt:
          - BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC
          - Arn
      Runtime: nodejs12.x
      Timeout: 300
    DependsOn:
      - BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36
      - BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC
  controllerframeindexerErrorAlarmCD9D41BD:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for controller_frame_indexer lambda errors
      AlarmName: controller_frame_indexerErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEcontrollerframeindexerFunc112D9367
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  controllerframeindexerThrottleAlarmA22F1F95:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for controller_frame_indexer lambda throttling
      AlarmName: controller_frame_indexerThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEcontrollerframeindexerFunc112D9367
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  SERVICENAMEcontrollerpolicyfetcherFuncServiceRole84291674:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEcontrollerpolicyfetcherFunc8FD92F33:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /controller_policy_fetcher.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyfetcherFuncServiceRole84291674
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -controller_policy_fetcher
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEcontrollerpolicyfetcherFuncServiceRole84291674
  SERVICENAMEcontrollerpolicyfetcherFuncInvokeServicePrincipalapigatewayamazonawscom6895620A:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyfetcherFunc8FD92F33
          - Arn
      Principal: apigateway.amazonaws.com
  controllerpolicyfetcherErrorAlarmD81243D6:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for controller_policy_fetcher lambda errors
      AlarmName: controller_policy_fetcherErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEcontrollerpolicyfetcherFunc8FD92F33
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  controllerpolicyfetcherThrottleAlarm1A92BEC4:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for controller_policy_fetcher lambda throttling
      AlarmName: controller_policy_fetcherThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEcontrollerpolicyfetcherFunc8FD92F33
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  SERVICENAMEcontrollerpolicyupdaterFuncServiceRole6F126C5A:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEcontrollerpolicyupdaterFunc51A684A9:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /controller_policy_updater.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyupdaterFuncServiceRole6F126C5A
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -controller_policy_updater
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEcontrollerpolicyupdaterFuncServiceRole6F126C5A
  SERVICENAMEcontrollerpolicyupdaterFuncInvokeServicePrincipalapigatewayamazonawscomEF787CDB:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyupdaterFunc51A684A9
          - Arn
      Principal: apigateway.amazonaws.com
  controllerpolicyupdaterErrorAlarmA32EC751:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for controller_policy_updater lambda errors
      AlarmName: controller_policy_updaterErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEcontrollerpolicyupdaterFunc51A684A9
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  controllerpolicyupdaterThrottleAlarmA18D23EC:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for controller_policy_updater lambda throttling
      AlarmName: controller_policy_updaterThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEcontrollerpolicyupdaterFunc51A684A9
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  SERVICENAMEdeviceconfigfetcherFuncServiceRole1A358B49:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEdeviceconfigfetcherFunc49D493BC:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /device_config_fetcher.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEdeviceconfigfetcherFuncServiceRole1A358B49
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -device_config_fetcher
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEdeviceconfigfetcherFuncServiceRole1A358B49
  SERVICENAMEdeviceconfigfetcherFuncInvokeServicePrincipalapigatewayamazonawscom0205957A:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceconfigfetcherFunc49D493BC
          - Arn
      Principal: apigateway.amazonaws.com
  deviceconfigfetcherErrorAlarm33870DF1:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for device_config_fetcher lambda errors
      AlarmName: device_config_fetcherErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEdeviceconfigfetcherFunc49D493BC
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  deviceconfigfetcherThrottleAlarmCEA06158:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for device_config_fetcher lambda throttling
      AlarmName: device_config_fetcherThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEdeviceconfigfetcherFunc49D493BC
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  SERVICENAMEdevicedescriptorfetcherFuncServiceRole80268A45:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEdevicedescriptorfetcherFuncD9F8F081:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /device_descriptor_fetcher.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEdevicedescriptorfetcherFuncServiceRole80268A45
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -device_descriptor_fetcher
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEdevicedescriptorfetcherFuncServiceRole80268A45
  SERVICENAMEdevicedescriptorfetcherFuncInvokeServicePrincipalapigatewayamazonawscom9EB8D4F7:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdevicedescriptorfetcherFuncD9F8F081
          - Arn
      Principal: apigateway.amazonaws.com
  devicedescriptorfetcherErrorAlarm430C9D67:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for device_descriptor_fetcher lambda errors
      AlarmName: device_descriptor_fetcherErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEdevicedescriptorfetcherFuncD9F8F081
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  devicedescriptorfetcherThrottleAlarm2D984A77:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for device_descriptor_fetcher lambda throttling
      AlarmName: device_descriptor_fetcherThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEdevicedescriptorfetcherFuncD9F8F081
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  SERVICENAMEdeviceeventdispatcherFuncServiceRole0E77D845:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEdeviceeventdispatcherFunc8DFC46F1:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /device_event_dispatcher.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventdispatcherFuncServiceRole0E77D845
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -device_event_dispatcher
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEdeviceeventdispatcherFuncServiceRole0E77D845
  SERVICENAMEdeviceeventdispatcherFuncInvokeServicePrincipalapigatewayamazonawscomA85D7D8E:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventdispatcherFunc8DFC46F1
          - Arn
      Principal: apigateway.amazonaws.com
  deviceeventdispatcherErrorAlarm613D47D1:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for device_event_dispatcher lambda errors
      AlarmName: device_event_dispatcherErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEdeviceeventdispatcherFunc8DFC46F1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  deviceeventdispatcherThrottleAlarm6AA20D07:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for device_event_dispatcher lambda throttling
      AlarmName: device_event_dispatcherThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEdeviceeventdispatcherFunc8DFC46F1
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  SERVICENAMEdeviceeventfetcherFuncServiceRoleE5CDC1D9:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEdeviceeventfetcherFunc8080C122:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /device_event_fetcher.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventfetcherFuncServiceRoleE5CDC1D9
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -device_event_fetcher
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEdeviceeventfetcherFuncServiceRoleE5CDC1D9
  SERVICENAMEdeviceeventfetcherFuncInvokeServicePrincipalapigatewayamazonawscomDA614DA3:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventfetcherFunc8080C122
          - Arn
      Principal: apigateway.amazonaws.com
  deviceeventfetcherErrorAlarm410DBCEF:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for device_event_fetcher lambda errors
      AlarmName: device_event_fetcherErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEdeviceeventfetcherFunc8080C122
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  deviceeventfetcherThrottleAlarm2D08278E:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for device_event_fetcher lambda throttling
      AlarmName: device_event_fetcherThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEdeviceeventfetcherFunc8080C122
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  SERVICENAMEglobalpolicyfetcherFuncServiceRoleFB2A6A36:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEglobalpolicyfetcherFunc1726BA23:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /global_policy_fetcher.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyfetcherFuncServiceRoleFB2A6A36
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -global_policy_fetcher
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEglobalpolicyfetcherFuncServiceRoleFB2A6A36
  SERVICENAMEglobalpolicyfetcherFuncInvokeServicePrincipalapigatewayamazonawscom7148F66E:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyfetcherFunc1726BA23
          - Arn
      Principal: apigateway.amazonaws.com
  globalpolicyfetcherErrorAlarm66A4FF3B:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for global_policy_fetcher lambda errors
      AlarmName: global_policy_fetcherErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEglobalpolicyfetcherFunc1726BA23
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  globalpolicyfetcherThrottleAlarm86415DB2:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for global_policy_fetcher lambda throttling
      AlarmName: global_policy_fetcherThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEglobalpolicyfetcherFunc1726BA23
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  SERVICENAMEglobalpolicyupdaterFuncServiceRole532869DD:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEglobalpolicyupdaterFunc018F4F28:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /global_policy_updater.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyupdaterFuncServiceRole532869DD
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -global_policy_updater
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEglobalpolicyupdaterFuncServiceRole532869DD
  SERVICENAMEglobalpolicyupdaterFuncInvokeServicePrincipalapigatewayamazonawscom22E9FF95:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyupdaterFunc018F4F28
          - Arn
      Principal: apigateway.amazonaws.com
  globalpolicyupdaterErrorAlarmE510062B:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for global_policy_updater lambda errors
      AlarmName: global_policy_updaterErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEglobalpolicyupdaterFunc018F4F28
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  globalpolicyupdaterThrottleAlarmA7A5A764:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for global_policy_updater lambda throttling
      AlarmName: global_policy_updaterThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEglobalpolicyupdaterFunc018F4F28
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  SERVICENAMEuserpostsigninFuncServiceRole1B17B411:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
        - arn:aws:iam::aws:policy/AmazonSSMReadOnlyAccess
        - arn:aws:iam::aws:policy/AWSIoTFullAccess
        - arn:aws:iam::aws:policy/AWSGreengrassFullAccess
        - arn:aws:iam::aws:policy/AmazonSQSFullAccess
  SERVICENAMEuserpostsigninFunc1A654159:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Ref: ArtifactsBucket
        S3Key:
          Fn::Join:
            - ""
            - - Ref: LambdaPrefix
              - /user_post_sign_in.zip
      Role:
        Fn::GetAtt:
          - SERVICENAMEuserpostsigninFuncServiceRole1B17B411
          - Arn
      Environment:
        Variables:
          ENV:
            Ref: Environment
          CORS_ORIGIN: "*"
          CORS_HEADERS: Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer
          CORS_METHODS: OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD
      FunctionName:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -user_post_sign_in
      Handler: app.handler.handler
      Layers:
        - Ref: SERVICENAMEcloudcommonLayer27E77984
      Runtime: python3.8
    DependsOn:
      - SERVICENAMEuserpostsigninFuncServiceRole1B17B411
  SERVICENAMEuserpostsigninFuncInvokeServicePrincipalapigatewayamazonawscom4BE60C96:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEuserpostsigninFunc1A654159
          - Arn
      Principal: apigateway.amazonaws.com
  userpostsigninErrorAlarm3E4E2A63:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for user_post_sign_in lambda errors
      AlarmName: user_post_sign_inErrorAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEuserpostsigninFunc1A654159
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  userpostsigninThrottleAlarm79E5902C:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      EvaluationPeriods: 1
      AlarmActions:
        - Fn::Join:
            - ""
            - - "arn:aws:sns:us-west-2:953022346399:"
              - Ref: Environment
              - "-"
              - Ref: Environment
              - -errors-notifications-alerts
      AlarmDescription: SNS Alarm for user_post_sign_in lambda throttling
      AlarmName: user_post_sign_inThrottleAlarm
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: SERVICENAMEuserpostsigninFunc1A654159
      MetricName: Throttles
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
  RestApi0C43BF4B:
    Type: AWS::ApiGateway::RestApi
    Properties:
      Name:
        Fn::Join:
          - ""
          - - Ref: Environment
            - "-"
            - Ref: ServiceName
            - -api
  RestApiCloudWatchRoleE3ED6605:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: apigateway.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs
  RestApiAccount7C83CF5A:
    Type: AWS::ApiGateway::Account
    Properties:
      CloudWatchRoleArn:
        Fn::GetAtt:
          - RestApiCloudWatchRoleE3ED6605
          - Arn
    DependsOn:
      - RestApi0C43BF4B
  RestApiDeployment180EC503739477951c2924269166337d3375ec59:
    Type: AWS::ApiGateway::Deployment
    Properties:
      RestApiId:
        Ref: RestApi0C43BF4B
      Description: Automatically created by the RestApi construct
    DependsOn:
      - RestApiadmincontrolleridframeGET611F2819
      - RestApiadmincontrolleridframeOPTIONSA6F8D7FA
      - RestApiadmincontrolleridframeABEC85E2
      - RestApiadmincontrolleridOPTIONSEFD18D04
      - RestApiadmincontrolleridF9912E53
      - RestApiadmincontrollerOPTIONS07FC8B9E
      - RestApiadmincontroller15E1F7F0
      - RestApiadmindeviceidconfigGET5BE5E473
      - RestApiadmindeviceidconfigOPTIONS6C5AB423
      - RestApiadmindeviceidconfig01DE198B
      - RestApiadmindeviceideventGET0A065406
      - RestApiadmindeviceideventOPTIONS82C9DD74
      - RestApiadmindeviceideventPOSTDCA58E79
      - RestApiadmindeviceideventCE3013CC
      - RestApiadmindeviceidOPTIONS2C9A4A3A
      - RestApiadmindeviceid99A54DAD
      - RestApiadmindeviceGET0649C25B
      - RestApiadmindeviceOPTIONS85CE2590
      - RestApiadmindeviceC27ACE95
      - RestApiadminOPTIONSE83BC9A1
      - RestApiadminpolicycontrolleridGETD2CA5640
      - RestApiadminpolicycontrolleridOPTIONS3B13FAAE
      - RestApiadminpolicycontrolleridPOSTFD906FC8
      - RestApiadminpolicycontrolleridC3479CB6
      - RestApiadminpolicycontrollerOPTIONSA8F847D7
      - RestApiadminpolicycontroller0B621B6B
      - RestApiadminpolicyglobaldeviceTypeGET3698EAED
      - RestApiadminpolicyglobaldeviceTypeOPTIONS399ABCA6
      - RestApiadminpolicyglobaldeviceTypePOST306371A7
      - RestApiadminpolicyglobaldeviceType86AA2248
      - RestApiadminpolicyglobalOPTIONSA25C2264
      - RestApiadminpolicyglobal20A9298A
      - RestApiadminpolicyOPTIONS6F360C1F
      - RestApiadminpolicy6DA57A4C
      - RestApiadmin3E3D47C6
      - RestApiadminuserOPTIONS94964CC1
      - RestApiadminuserpostsigninOPTIONSD638CE5B
      - RestApiadminuserpostsigninPOSTAA3267D2
      - RestApiadminuserpostsignin431D0C2C
      - RestApiadminuser73C98D70
      - RestApicontrolleridframeGET238CB2F4
      - RestApicontrolleridframeOPTIONSB4A74ACD
      - RestApicontrolleridframeCB9E3091
      - RestApicontrolleridOPTIONS020DD4DF
      - RestApicontrollerid6888ED0C
      - RestApicontrollerOPTIONS5B608975
      - RestApicontroller76BC0AA1
      - RestApideviceidconfigGET533D1A40
      - RestApideviceidconfigOPTIONS39B6C7C8
      - RestApideviceidconfig816D3F04
      - RestApideviceideventGET143EB058
      - RestApideviceideventOPTIONSD4CDBD0C
      - RestApideviceideventPOST251ECCD9
      - RestApideviceidevent47285C93
      - RestApideviceidOPTIONS892CC2A2
      - RestApideviceid267F3870
      - RestApideviceGET5CE59708
      - RestApideviceOPTIONS6B6BBE7F
      - RestApidevice34312178
      - RestApiOPTIONS6AA64D2D
      - RestApipolicycontrolleridGET6B0C6F6E
      - RestApipolicycontrolleridOPTIONSCCB5DE35
      - RestApipolicycontrolleridPOST84EFEA71
      - RestApipolicycontrolleridC600389B
      - RestApipolicycontrollerOPTIONSE80C462D
      - RestApipolicycontroller1011DBCE
      - RestApipolicyglobaldeviceTypeGETDE2C31DB
      - RestApipolicyglobaldeviceTypeOPTIONS2A5D4E10
      - RestApipolicyglobaldeviceTypePOST9B93500D
      - RestApipolicyglobaldeviceType29BEBAD6
      - RestApipolicyglobalOPTIONS575774D1
      - RestApipolicyglobal7E42F925
      - RestApipolicyOPTIONSB82849AF
      - RestApipolicy5BEF8CF9
      - RestApiuserOPTIONS772D24FD
      - RestApiuserpostsigninOPTIONS910196FC
      - RestApiuserpostsigninPOST1001B286
      - RestApiuserpostsigninE73B6278
      - RestApiuser043FE7E4
  RestApiDeploymentStageprod3855DE66:
    Type: AWS::ApiGateway::Stage
    Properties:
      RestApiId:
        Ref: RestApi0C43BF4B
      DeploymentId:
        Ref: RestApiDeployment180EC503739477951c2924269166337d3375ec59
      StageName: prod
  RestApiOPTIONS6AA64D2D:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Fn::GetAtt:
          - RestApi0C43BF4B
          - RootResourceId
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApicontroller76BC0AA1:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Fn::GetAtt:
          - RestApi0C43BF4B
          - RootResourceId
      PathPart: controller
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApicontrollerOPTIONS5B608975:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApicontroller76BC0AA1
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApicontrollerid6888ED0C:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApicontroller76BC0AA1
      PathPart: "{id}"
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApicontrolleridOPTIONS020DD4DF:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApicontrollerid6888ED0C
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApicontrolleridframeCB9E3091:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApicontrollerid6888ED0C
      PathPart: frame
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApicontrolleridframeOPTIONSB4A74ACD:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApicontrolleridframeCB9E3091
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApicontrolleridframeGETApiPermissionagronomistRestApi9F29DB99GETcontrolleridframeEFF54794:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerframefetcherFunc55749CA1
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/controller/*/frame
  RestApicontrolleridframeGETApiPermissionTestagronomistRestApi9F29DB99GETcontrolleridframe9F635C3D:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerframefetcherFunc55749CA1
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/controller/*/frame
  RestApicontrolleridframeGET238CB2F4:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApicontrolleridframeCB9E3091
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: serviceCognitoAuthorizer016061C3
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEcontrollerframefetcherFunc55749CA1
                  - Arn
              - /invocations
  RestApiadmin3E3D47C6:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Fn::GetAtt:
          - RestApi0C43BF4B
          - RootResourceId
      PathPart: _admin
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadminOPTIONSE83BC9A1:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadmin3E3D47C6
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadmincontroller15E1F7F0:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadmin3E3D47C6
      PathPart: controller
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadmincontrollerOPTIONS07FC8B9E:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadmincontroller15E1F7F0
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadmincontrolleridF9912E53:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadmincontroller15E1F7F0
      PathPart: "{id}"
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadmincontrolleridOPTIONSEFD18D04:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadmincontrolleridF9912E53
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadmincontrolleridframeABEC85E2:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadmincontrolleridF9912E53
      PathPart: frame
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadmincontrolleridframeOPTIONSA6F8D7FA:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadmincontrolleridframeABEC85E2
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadmincontrolleridframeGETApiPermissionagronomistRestApi9F29DB99GETadmincontrolleridframe11C6F082:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerframefetcherFunc55749CA1
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/_admin/controller/*/frame
  RestApiadmincontrolleridframeGETApiPermissionTestagronomistRestApi9F29DB99GETadmincontrolleridframe7A8D1779:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerframefetcherFunc55749CA1
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/_admin/controller/*/frame
  RestApiadmincontrolleridframeGET611F2819:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApiadmincontrolleridframeABEC85E2
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: AWS_IAM
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEcontrollerframefetcherFunc55749CA1
                  - Arn
              - /invocations
  RestApiadminpolicy6DA57A4C:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadmin3E3D47C6
      PathPart: policy
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadminpolicyOPTIONS6F360C1F:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadminpolicy6DA57A4C
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadminpolicycontroller0B621B6B:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadminpolicy6DA57A4C
      PathPart: controller
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadminpolicycontrollerOPTIONSA8F847D7:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadminpolicycontroller0B621B6B
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadminpolicycontrolleridC3479CB6:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadminpolicycontroller0B621B6B
      PathPart: "{id}"
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadminpolicycontrolleridOPTIONS3B13FAAE:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadminpolicycontrolleridC3479CB6
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadminpolicycontrolleridGETApiPermissionagronomistRestApi9F29DB99GETadminpolicycontrollerid67EFB06B:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyfetcherFunc8FD92F33
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/_admin/policy/controller/*
  RestApiadminpolicycontrolleridGETApiPermissionTestagronomistRestApi9F29DB99GETadminpolicycontrolleridA8CDF00F:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyfetcherFunc8FD92F33
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/_admin/policy/controller/*
  RestApiadminpolicycontrolleridGETD2CA5640:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApiadminpolicycontrolleridC3479CB6
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: AWS_IAM
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEcontrollerpolicyfetcherFunc8FD92F33
                  - Arn
              - /invocations
  RestApiadminpolicycontrolleridPOSTApiPermissionagronomistRestApi9F29DB99POSTadminpolicycontrollerid5E89D55E:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyupdaterFunc51A684A9
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /POST/_admin/policy/controller/*
  RestApiadminpolicycontrolleridPOSTApiPermissionTestagronomistRestApi9F29DB99POSTadminpolicycontrollerid22E7BCD3:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyupdaterFunc51A684A9
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/POST/_admin/policy/controller/*
  RestApiadminpolicycontrolleridPOSTFD906FC8:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: POST
      ResourceId:
        Ref: RestApiadminpolicycontrolleridC3479CB6
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: AWS_IAM
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEcontrollerpolicyupdaterFunc51A684A9
                  - Arn
              - /invocations
  RestApiadminpolicyglobal20A9298A:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadminpolicy6DA57A4C
      PathPart: global
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadminpolicyglobalOPTIONSA25C2264:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadminpolicyglobal20A9298A
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadminpolicyglobaldeviceType86AA2248:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadminpolicyglobal20A9298A
      PathPart: "{deviceType}"
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadminpolicyglobaldeviceTypeOPTIONS399ABCA6:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadminpolicyglobaldeviceType86AA2248
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadminpolicyglobaldeviceTypeGETApiPermissionagronomistRestApi9F29DB99GETadminpolicyglobaldeviceTypeE8C6CBAE:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyfetcherFunc1726BA23
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/_admin/policy/global/*
  RestApiadminpolicyglobaldeviceTypeGETApiPermissionTestagronomistRestApi9F29DB99GETadminpolicyglobaldeviceType36E983B7:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyfetcherFunc1726BA23
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/_admin/policy/global/*
  RestApiadminpolicyglobaldeviceTypeGET3698EAED:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApiadminpolicyglobaldeviceType86AA2248
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: AWS_IAM
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEglobalpolicyfetcherFunc1726BA23
                  - Arn
              - /invocations
  RestApiadminpolicyglobaldeviceTypePOSTApiPermissionagronomistRestApi9F29DB99POSTadminpolicyglobaldeviceTypeE3484633:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyupdaterFunc018F4F28
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /POST/_admin/policy/global/*
  RestApiadminpolicyglobaldeviceTypePOSTApiPermissionTestagronomistRestApi9F29DB99POSTadminpolicyglobaldeviceType9086BDEB:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyupdaterFunc018F4F28
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/POST/_admin/policy/global/*
  RestApiadminpolicyglobaldeviceTypePOST306371A7:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: POST
      ResourceId:
        Ref: RestApiadminpolicyglobaldeviceType86AA2248
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: AWS_IAM
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEglobalpolicyupdaterFunc018F4F28
                  - Arn
              - /invocations
  RestApiadmindeviceC27ACE95:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadmin3E3D47C6
      PathPart: device
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadmindeviceOPTIONS85CE2590:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadmindeviceC27ACE95
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadmindeviceid99A54DAD:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadmindeviceC27ACE95
      PathPart: "{id}"
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadmindeviceidOPTIONS2C9A4A3A:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadmindeviceid99A54DAD
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadmindeviceidconfig01DE198B:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadmindeviceid99A54DAD
      PathPart: config
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadmindeviceidconfigOPTIONS6C5AB423:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadmindeviceidconfig01DE198B
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadmindeviceidconfigGETApiPermissionagronomistRestApi9F29DB99GETadmindeviceidconfigC99F5158:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceconfigfetcherFunc49D493BC
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/_admin/device/*/config
  RestApiadmindeviceidconfigGETApiPermissionTestagronomistRestApi9F29DB99GETadmindeviceidconfigD53E3C8B:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceconfigfetcherFunc49D493BC
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/_admin/device/*/config
  RestApiadmindeviceidconfigGET5BE5E473:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApiadmindeviceidconfig01DE198B
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: AWS_IAM
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEdeviceconfigfetcherFunc49D493BC
                  - Arn
              - /invocations
  RestApiadmindeviceideventCE3013CC:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadmindeviceid99A54DAD
      PathPart: event
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadmindeviceideventOPTIONS82C9DD74:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadmindeviceideventCE3013CC
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadmindeviceideventPOSTApiPermissionagronomistRestApi9F29DB99POSTadmindeviceidevent705736AA:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventdispatcherFunc8DFC46F1
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /POST/_admin/device/*/event
  RestApiadmindeviceideventPOSTApiPermissionTestagronomistRestApi9F29DB99POSTadmindeviceideventE02B1172:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventdispatcherFunc8DFC46F1
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/POST/_admin/device/*/event
  RestApiadmindeviceideventPOSTDCA58E79:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: POST
      ResourceId:
        Ref: RestApiadmindeviceideventCE3013CC
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: AWS_IAM
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEdeviceeventdispatcherFunc8DFC46F1
                  - Arn
              - /invocations
  RestApiadmindeviceideventGETApiPermissionagronomistRestApi9F29DB99GETadmindeviceidevent545AC545:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventfetcherFunc8080C122
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/_admin/device/*/event
  RestApiadmindeviceideventGETApiPermissionTestagronomistRestApi9F29DB99GETadmindeviceidevent950304E0:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventfetcherFunc8080C122
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/_admin/device/*/event
  RestApiadmindeviceideventGET0A065406:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApiadmindeviceideventCE3013CC
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: AWS_IAM
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEdeviceeventfetcherFunc8080C122
                  - Arn
              - /invocations
  RestApiadmindeviceGETApiPermissionagronomistRestApi9F29DB99GETadmindeviceE65FB19C:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdevicedescriptorfetcherFuncD9F8F081
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/_admin/device
  RestApiadmindeviceGETApiPermissionTestagronomistRestApi9F29DB99GETadmindeviceC103AB04:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdevicedescriptorfetcherFuncD9F8F081
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/_admin/device
  RestApiadmindeviceGET0649C25B:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApiadmindeviceC27ACE95
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: AWS_IAM
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEdevicedescriptorfetcherFuncD9F8F081
                  - Arn
              - /invocations
  RestApiadminuser73C98D70:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadmin3E3D47C6
      PathPart: user
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadminuserOPTIONS94964CC1:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadminuser73C98D70
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadminuserpostsignin431D0C2C:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiadminuser73C98D70
      PathPart: post-sign-in
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiadminuserpostsigninOPTIONSD638CE5B:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiadminuserpostsignin431D0C2C
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiadminuserpostsigninPOSTApiPermissionagronomistRestApi9F29DB99POSTadminuserpostsignin906D3485:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEuserpostsigninFunc1A654159
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /POST/_admin/user/post-sign-in
  RestApiadminuserpostsigninPOSTApiPermissionTestagronomistRestApi9F29DB99POSTadminuserpostsigninA7FC4C5A:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEuserpostsigninFunc1A654159
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/POST/_admin/user/post-sign-in
  RestApiadminuserpostsigninPOSTAA3267D2:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: POST
      ResourceId:
        Ref: RestApiadminuserpostsignin431D0C2C
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: AWS_IAM
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEuserpostsigninFunc1A654159
                  - Arn
              - /invocations
  RestApipolicy5BEF8CF9:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Fn::GetAtt:
          - RestApi0C43BF4B
          - RootResourceId
      PathPart: policy
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApipolicyOPTIONSB82849AF:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApipolicy5BEF8CF9
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApipolicycontroller1011DBCE:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApipolicy5BEF8CF9
      PathPart: controller
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApipolicycontrollerOPTIONSE80C462D:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApipolicycontroller1011DBCE
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApipolicycontrolleridC600389B:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApipolicycontroller1011DBCE
      PathPart: "{id}"
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApipolicycontrolleridOPTIONSCCB5DE35:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApipolicycontrolleridC600389B
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApipolicycontrolleridGETApiPermissionagronomistRestApi9F29DB99GETpolicycontrollerid22666EA0:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyfetcherFunc8FD92F33
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/policy/controller/*
  RestApipolicycontrolleridGETApiPermissionTestagronomistRestApi9F29DB99GETpolicycontrolleridB3FA7208:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyfetcherFunc8FD92F33
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/policy/controller/*
  RestApipolicycontrolleridGET6B0C6F6E:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApipolicycontrolleridC600389B
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: serviceCognitoAuthorizer016061C3
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEcontrollerpolicyfetcherFunc8FD92F33
                  - Arn
              - /invocations
  RestApipolicycontrolleridPOSTApiPermissionagronomistRestApi9F29DB99POSTpolicycontrollerid2BEE0C7E:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyupdaterFunc51A684A9
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /POST/policy/controller/*
  RestApipolicycontrolleridPOSTApiPermissionTestagronomistRestApi9F29DB99POSTpolicycontrollerid65FF5F16:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEcontrollerpolicyupdaterFunc51A684A9
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/POST/policy/controller/*
  RestApipolicycontrolleridPOST84EFEA71:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: POST
      ResourceId:
        Ref: RestApipolicycontrolleridC600389B
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: serviceCognitoAuthorizer016061C3
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEcontrollerpolicyupdaterFunc51A684A9
                  - Arn
              - /invocations
  RestApipolicyglobal7E42F925:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApipolicy5BEF8CF9
      PathPart: global
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApipolicyglobalOPTIONS575774D1:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApipolicyglobal7E42F925
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApipolicyglobaldeviceType29BEBAD6:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApipolicyglobal7E42F925
      PathPart: "{deviceType}"
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApipolicyglobaldeviceTypeOPTIONS2A5D4E10:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApipolicyglobaldeviceType29BEBAD6
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApipolicyglobaldeviceTypeGETApiPermissionagronomistRestApi9F29DB99GETpolicyglobaldeviceTypeBDBE5B0C:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyfetcherFunc1726BA23
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/policy/global/*
  RestApipolicyglobaldeviceTypeGETApiPermissionTestagronomistRestApi9F29DB99GETpolicyglobaldeviceType89E63164:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyfetcherFunc1726BA23
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/policy/global/*
  RestApipolicyglobaldeviceTypeGETDE2C31DB:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApipolicyglobaldeviceType29BEBAD6
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: serviceCognitoAuthorizer016061C3
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEglobalpolicyfetcherFunc1726BA23
                  - Arn
              - /invocations
  RestApipolicyglobaldeviceTypePOSTApiPermissionagronomistRestApi9F29DB99POSTpolicyglobaldeviceType38222442:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyupdaterFunc018F4F28
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /POST/policy/global/*
  RestApipolicyglobaldeviceTypePOSTApiPermissionTestagronomistRestApi9F29DB99POSTpolicyglobaldeviceType9C4103AC:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEglobalpolicyupdaterFunc018F4F28
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/POST/policy/global/*
  RestApipolicyglobaldeviceTypePOST9B93500D:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: POST
      ResourceId:
        Ref: RestApipolicyglobaldeviceType29BEBAD6
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: serviceCognitoAuthorizer016061C3
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEglobalpolicyupdaterFunc018F4F28
                  - Arn
              - /invocations
  RestApidevice34312178:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Fn::GetAtt:
          - RestApi0C43BF4B
          - RootResourceId
      PathPart: device
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApideviceOPTIONS6B6BBE7F:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApidevice34312178
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApideviceid267F3870:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApidevice34312178
      PathPart: "{id}"
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApideviceidOPTIONS892CC2A2:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApideviceid267F3870
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApideviceidconfig816D3F04:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApideviceid267F3870
      PathPart: config
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApideviceidconfigOPTIONS39B6C7C8:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApideviceidconfig816D3F04
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApideviceidconfigGETApiPermissionagronomistRestApi9F29DB99GETdeviceidconfigA712B60A:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceconfigfetcherFunc49D493BC
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/device/*/config
  RestApideviceidconfigGETApiPermissionTestagronomistRestApi9F29DB99GETdeviceidconfigCF4CD0C5:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceconfigfetcherFunc49D493BC
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/device/*/config
  RestApideviceidconfigGET533D1A40:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApideviceidconfig816D3F04
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: serviceCognitoAuthorizer016061C3
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEdeviceconfigfetcherFunc49D493BC
                  - Arn
              - /invocations
  RestApideviceidevent47285C93:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApideviceid267F3870
      PathPart: event
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApideviceideventOPTIONSD4CDBD0C:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApideviceidevent47285C93
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApideviceideventPOSTApiPermissionagronomistRestApi9F29DB99POSTdeviceidevent53625549:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventdispatcherFunc8DFC46F1
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /POST/device/*/event
  RestApideviceideventPOSTApiPermissionTestagronomistRestApi9F29DB99POSTdeviceideventCE21DF48:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventdispatcherFunc8DFC46F1
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/POST/device/*/event
  RestApideviceideventPOST251ECCD9:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: POST
      ResourceId:
        Ref: RestApideviceidevent47285C93
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: serviceCognitoAuthorizer016061C3
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEdeviceeventdispatcherFunc8DFC46F1
                  - Arn
              - /invocations
  RestApideviceideventGETApiPermissionagronomistRestApi9F29DB99GETdeviceidevent17A676C6:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventfetcherFunc8080C122
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/device/*/event
  RestApideviceideventGETApiPermissionTestagronomistRestApi9F29DB99GETdeviceideventB94D28C5:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdeviceeventfetcherFunc8080C122
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/device/*/event
  RestApideviceideventGET143EB058:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApideviceidevent47285C93
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: serviceCognitoAuthorizer016061C3
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEdeviceeventfetcherFunc8080C122
                  - Arn
              - /invocations
  RestApideviceGETApiPermissionagronomistRestApi9F29DB99GETdevice52154108:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdevicedescriptorfetcherFuncD9F8F081
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /GET/device
  RestApideviceGETApiPermissionTestagronomistRestApi9F29DB99GETdevice6E30B231:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEdevicedescriptorfetcherFuncD9F8F081
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/GET/device
  RestApideviceGET5CE59708:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: GET
      ResourceId:
        Ref: RestApidevice34312178
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: serviceCognitoAuthorizer016061C3
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEdevicedescriptorfetcherFuncD9F8F081
                  - Arn
              - /invocations
  RestApiuser043FE7E4:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Fn::GetAtt:
          - RestApi0C43BF4B
          - RootResourceId
      PathPart: user
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiuserOPTIONS772D24FD:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiuser043FE7E4
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiuserpostsigninE73B6278:
    Type: AWS::ApiGateway::Resource
    Properties:
      ParentId:
        Ref: RestApiuser043FE7E4
      PathPart: post-sign-in
      RestApiId:
        Ref: RestApi0C43BF4B
  RestApiuserpostsigninOPTIONS910196FC:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: OPTIONS
      ResourceId:
        Ref: RestApiuserpostsigninE73B6278
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: NONE
      Integration:
        IntegrationResponses:
          - ResponseParameters:
              method.response.header.Access-Control-Allow-Headers: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,Accept,User-Agent,Referer'"
              method.response.header.Access-Control-Allow-Origin: "'*'"
              method.response.header.Access-Control-Allow-Methods: "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'"
            StatusCode: "204"
        RequestTemplates:
          application/json: "{ statusCode: 200 }"
        Type: MOCK
      MethodResponses:
        - ResponseParameters:
            method.response.header.Access-Control-Allow-Headers: true
            method.response.header.Access-Control-Allow-Origin: true
            method.response.header.Access-Control-Allow-Methods: true
          StatusCode: "204"
  RestApiuserpostsigninPOSTApiPermissionagronomistRestApi9F29DB99POSTuserpostsignin160CD973:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEuserpostsigninFunc1A654159
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /
            - Ref: RestApiDeploymentStageprod3855DE66
            - /POST/user/post-sign-in
  RestApiuserpostsigninPOSTApiPermissionTestagronomistRestApi9F29DB99POSTuserpostsignin5EAF5045:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - SERVICENAMEuserpostsigninFunc1A654159
          - Arn
      Principal: apigateway.amazonaws.com
      SourceArn:
        Fn::Join:
          - ""
          - - "arn:"
            - Ref: AWS::Partition
            - ":execute-api:"
            - Ref: AWS::Region
            - ":"
            - Ref: AWS::AccountId
            - ":"
            - Ref: RestApi0C43BF4B
            - /test-invoke-stage/POST/user/post-sign-in
  RestApiuserpostsigninPOST1001B286:
    Type: AWS::ApiGateway::Method
    Properties:
      HttpMethod: POST
      ResourceId:
        Ref: RestApiuserpostsigninE73B6278
      RestApiId:
        Ref: RestApi0C43BF4B
      AuthorizationType: COGNITO_USER_POOLS
      AuthorizerId:
        Ref: serviceCognitoAuthorizer016061C3
      Integration:
        IntegrationHttpMethod: POST
        Type: AWS_PROXY
        Uri:
          Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - ":apigateway:"
              - Ref: AWS::Region
              - :lambda:path/2015-03-31/functions/
              - Fn::GetAtt:
                  - SERVICENAMEuserpostsigninFunc1A654159
                  - Arn
              - /invocations
Outputs:
  RestApiEndpoint0551178A:
    Value:
      Fn::Join:
        - ""
        - - https://
          - Ref: RestApi0C43BF4B
          - .execute-api.
          - Ref: AWS::Region
          - "."
          - Ref: AWS::URLSuffix
          - /
          - Ref: RestApiDeploymentStageprod3855DE66
          - /

