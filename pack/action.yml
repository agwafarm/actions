name: 'pack'
description: 'Packakge RC for this service'
inputs:
  library-tag:
    description: 'Service Library tag to use'
    required: true
runs:
  using: "composite"
  steps:
    - run: |
          
          app_service_name=$(echo $GITHUB_REPOSITORY | sed -e 's/^agwafarm\///')
          app_service_name=$(echo $app_service_name | sed -e 's/^agwa\-//')
          app_service_name=$(echo $app_service_name | sed -e 's/^\-service//')
          echo deploying service $app_service_name

          git_sha=$GITHUB_SHA
          echo git sha $git_sha

          branch_name=$(echo $GITHUB_HEAD_REF | sed -e 's/^refs\/heads\///')
          echo $branch_name

          if [ "$branch_name" = "main" ] || [ "$branch_name" = "master" ]; then
             target_env=test
          else
             target_env=dev-$GITHUB_ACTOR
          fi

          s3_key_prefix=s3://agwa-cloud-lambda-sourcecode/$target_env/$app_service_name
          echo s3 prefix $s3_key_prefix

      shell: bash